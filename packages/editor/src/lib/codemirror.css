.codemirror-wrapper {
	height: 100%;
}

.cm-editor {
	color: var(--sk-code-base);
	background-color: transparent;
	height: 100%;

	&.cm-focused {
		.cm-cursor {
			border-left-color: var(--sk-text-3);
		}

		> .cm-scroller > .cm-selectionLayer .cm-selectionBackground,
		.cm-selectionBackground,
		.cm-content ::selection {
			background-color: var(--sk-selection-color);
		}

		.cm-matchingBracket,
		.cm-nonmatchingBracket {
			background-color: #bad0f847;
		}
	}

	.cm-scroller {
		font: var(--sk-font-mono);
	}

	.cm-gutters {
		background: var(--sk-back-3);
		border: none;
		padding: 0;
		width: 5rem;
	}

	.cm-activeLine {
		background: var(--sk-back-translucent);
	}

	.cm-activeLineGutter {
		background-color: var(--sk-back-3);
	}

	.cm-lineNumbers {
		flex: 1;

		.cm-gutterElement:not(:last-child) {
			display: flex;
			justify-content: end;
			align-items: end;
		}
	}

	.cm-foldGutter {
		width: 1rem;
	}

	.cm-foldPlaceholder {
		background-color: transparent;
		border: none;
		color: #ddd;
	}

	.cm-lintRange {
		background-position: left bottom;
		background-repeat: repeat-x;
		padding-bottom: 4px;

		&.cm-lintRange-error {
			/* TODO */
		}

		&.cm-lintRange-warning {
			/* TODO */
		}
	}

	.cm-content {
		/* ensure no gap between top of editor and highlighted first/last line */
		padding-top: 0;
		padding-bottom: 0;

		.cm-line:first-child {
			padding-top: 4px;
		}

		.cm-line:last-child {
			padding-bottom: 4px;
		}
	}

	.cm-line {
		padding: 0 1rem;
	}

	.cm-selectionBackground {
		border-radius: 2px;
	}

	.cm-selectionMatch {
		background: var(--selection-color);
		color: var(--sk-text-2);
	}

	.cm-tooltip.cm-tooltip-autocomplete {
		color: var(--sk-text-2) !important;
		perspective: 1px;

		& > ul > li[aria-selected] {
			background-color: var(--sk-back-4);
			color: var(--sk-text-1) !important;
		}

		& > ul {
			font: var(--sk-font-mono);
		}
	}

	.cm-panels {
		background: var(--sk-back-4);
		color: var(--sk-text-1);

		&.cm-panels-top,
		&.cm-panels-bottom {
			border-top: 1px solid var(--sk-back-5);
			border-bottom: 1px solid var(--sk-back-5);
		}
	}

	.cm-button {
		background: var(--sk-back-5);
		border: 2px solid transparent;
	}

	.cm-textfield {
		background: var(--sk-back-1);
		color: var(--sk-text-1);
		border: 2px solid transparent;
	}

	.cm-search button:focus-visible,
	.cm-search input:focus-visible {
		border: 2px solid var(--flash);
	}

	.cm-search input[type='checkbox']:focus-visible {
		outline: 2px solid var(--flash);
	}

	.cm-searchMatch.cm-searchMatch-selected {
		background-color: #6199ff2f;
	}

	.cm-tooltip {
		--warning: hsl(40 100% 70%);
		--error: hsl(0 100% 90%);
		border: none;
		background: var(--sk-back-3);
		font: var(--sk-font-ui-small);
		max-width: calc(100vw - 10em);
		position: relative;
		filter: drop-shadow(2px 4px 6px rgba(0, 0, 0, 0.1));

		:root.dark {
			--warning: hsl(40 100% 50%);
			--error: hsl(0 100% 70%);
		}

		&:has(.cm-diagnostic) {
			background: transparent;
		}

		&:has(.cm-diagnostic-warning) {
			--bg: var(--warning);
			--fg: #222;
		}

		&:has(.cm-diagnostic-error) {
			--bg: var(--error);
			--fg: #222;
		}

		.cm-tooltip-section {
			position: relative;
			left: -1rem;
			background: var(--bg);
			border-radius: 2px;
			max-width: 64em;
		}

		&.cm-tooltip-below .cm-tooltip-section {
			top: 1rem;
		}

		&.cm-tooltip-above .cm-tooltip-section {
			bottom: 1rem;
		}
	}

	.cm-diagnostic {
		padding: 0.2em 0.4em;
		position: relative;
		border: none;
		border-radius: 2px;

		&:not(:last-child) {
			border-bottom: 1px solid rgba(0, 0, 0, 0.1);
		}

		&.cm-diagnostic-error {
			border: none;
			filter: drop-shadow(0px 0px 6px var(--error-bg));
		}

		:not(code) {
			font: var(--sk-font-ui-small);
		}

		.cm-diagnosticText {
			color: var(--fg);
			position: relative;
			z-index: 2;

			code {
				color: inherit;
				background-color: rgba(0, 0, 0, 0.05);
				border-radius: 2px;
				top: 0;
				padding: 0.2em;
				font-size: 1em;
			}

			strong {
				font: var(--sk-font-mono);
				opacity: 0.7;
			}
		}
	}
}
